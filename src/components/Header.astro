---
import { Phone, Send, Menu, X } from 'lucide-react';

const phoneDisplay = '+7 (999) 123-45-67';
const phoneLink = 'tel:+79991234567';
const telegramLink = 'https://t.me/ваш_ник'; 

const navLinks = [
  { href: '/services', label: 'Услуги' },
  { href: '/projects', label: 'Проекты' },
  { href: '/pricing', label: 'Цены' },
  { href: '/contact', label: 'Контакты' },
];
---

<header class="fixed top-6 left-0 right-0 z-[100] px-4" id="main-header">
  <div class="container mx-auto max-w-6xl relative">
    
    {/* Панель шапки */}
    <div class="glass-panel rounded-full px-6 py-4 flex items-center justify-between shadow-glow relative z-[101] bg-white/80 backdrop-blur-xl border border-white/40 transition-all duration-300" id="header-panel">
      
      <a href="/" class="text-2xl font-serif font-bold text-primary tracking-tight shrink-0">
        PlantUP
      </a>

      {/* Меню (Десктоп) */}
      <nav class="hidden md:flex items-center gap-8">
        {navLinks.map(link => (
          <a href={link.href} class="text-primary/80 hover:text-primary transition-colors font-medium text-sm uppercase tracking-wider">
            {link.label}
          </a>
        ))}
      </nav>

      {/* Контакты (Десктоп) */}
      <div class="hidden md:flex items-center gap-4 shrink-0">
        <a href={phoneLink} class="flex items-center gap-2 text-primary font-medium hover:text-accent transition-colors">
          <Phone className="w-5 h-5" />
          <span>{phoneDisplay}</span>
        </a>
      </div>

      {/* КНОПКА МОБИЛЬНОГО МЕНЮ */}
      <button id="mobile-menu-toggle" class="md:hidden text-primary p-2 -mr-2 cursor-pointer z-[102] relative active:scale-95 transition-transform" aria-label="Меню">
        <div id="icon-menu">
            <Menu className="w-8 h-8" />
        </div>
        <div id="icon-close" class="hidden">
            <X className="w-8 h-8" />
        </div>
      </button>

    </div>

    {/* Выпадающее меню */}
    <div id="mobile-menu" class="absolute top-full left-0 right-0 mt-2 hidden md:hidden origin-top transition-all duration-300 z-[100]">
       <div class="glass-panel rounded-3xl p-6 flex flex-col gap-6 shadow-xl bg-white/95 backdrop-blur-xl border border-white/40">
         <nav class="flex flex-col gap-4 text-center">
          {navLinks.map(link => (
            <a href={link.href} class="text-primary text-xl font-medium py-3 border-b border-primary/10 last:border-0 mobile-link">
              {link.label}
            </a>
          ))}
         </nav>
         
         <div class="flex flex-col items-center gap-4 pt-4 border-t border-primary/20">
            <a href={phoneLink} class="flex items-center gap-2 text-primary font-bold text-lg">
              <Phone className="w-6 h-6" />
              <span>{phoneDisplay}</span>
            </a>
            <a href={telegramLink} class="bg-primary text-white px-6 py-4 rounded-full hover:bg-accent transition-colors flex items-center justify-center gap-2 w-full max-w-xs font-medium text-lg">
               <Send className="w-6 h-6" />
               <span>Написать в Telegram</span>
            </a>
         </div>
       </div>
    </div>

  </div>
</header>

<script is:inline>
  // Используем событие astro:page-load для поддержки переходов
  document.addEventListener('astro:page-load', function() {
    var btn = document.getElementById('mobile-menu-toggle');
    var menu = document.getElementById('mobile-menu');
    var headerPanel = document.getElementById('header-panel');
    var iconMenu = document.getElementById('icon-menu');
    var iconClose = document.getElementById('icon-close');

    if (!btn || !menu) return;

    // Клонируем кнопку, чтобы удалить старые сломанные обработчики
    var newBtn = btn.cloneNode(true);
    btn.parentNode.replaceChild(newBtn, btn);

    // Функция переключения
    function toggleMenu() {
      var isHidden = menu.classList.contains('hidden');
      if (isHidden) {
        // Открыть
        menu.classList.remove('hidden');
        if (iconMenu) iconMenu.classList.add('hidden');
        if (iconClose) iconClose.classList.remove('hidden');
        if (headerPanel) {
           headerPanel.classList.remove('rounded-full');
           headerPanel.classList.add('rounded-t-3xl', 'rounded-b-lg');
        }
      } else {
        // Закрыть
        menu.classList.add('hidden');
        if (iconMenu) iconMenu.classList.remove('hidden');
        if (iconClose) iconClose.classList.add('hidden');
        if (headerPanel) {
           headerPanel.classList.add('rounded-full');
           headerPanel.classList.remove('rounded-t-3xl', 'rounded-b-lg');
        }
      }
    }

    // Клик по кнопке
    newBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      toggleMenu();
    });

    // Клик вне меню (закрытие)
    document.addEventListener('click', function(e) {
      if (menu.classList.contains('hidden')) return;
      
      var isClickInside = menu.contains(e.target) || newBtn.contains(e.target);
      if (!isClickInside) {
        menu.classList.add('hidden');
        if (iconMenu) iconMenu.classList.remove('hidden');
        if (iconClose) iconClose.classList.add('hidden');
        if (headerPanel) {
           headerPanel.classList.add('rounded-full');
           headerPanel.classList.remove('rounded-t-3xl', 'rounded-b-lg');
        }
      }
    });
  });
</script>
