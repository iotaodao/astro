---
import { Phone, Send, Menu, X } from 'lucide-react';

const phoneDisplay = '+7 (999) 123-45-67';
const phoneLink = 'tel:+79991234567';
const telegramLink = 'https://t.me/ваш_ник'; 

const navLinks = [
  { href: '/services', label: 'Услуги' },
  { href: '/projects', label: 'Проекты' },
  { href: '/pricing', label: 'Цены' },
  { href: '/contact', label: 'Контакты' },
];
---

<header class="fixed top-6 left-0 right-0 z-[100] px-4" id="main-header">
  <div class="container mx-auto max-w-6xl relative">
    
    {/* ВЕРХНЯЯ ПАНЕЛЬ (Liquid Style) */}
    <div class="rounded-full px-6 py-4 flex items-center justify-between shadow-lg relative z-[101] bg-white/20 backdrop-blur-xl backdrop-saturate-150 border border-white/20 transition-all duration-500 ease-in-out" id="header-panel">
      
      <a href="/" class="text-2xl font-serif font-bold text-primary tracking-tight shrink-0">
        PlantUP
      </a>

      {/* Меню (Десктоп) */}
      <nav class="hidden md:flex items-center gap-8">
        {navLinks.map(link => (
          <a href={link.href} class="text-primary/80 hover:text-primary transition-colors font-medium text-sm uppercase tracking-wider">
            {link.label}
          </a>
        ))}
      </nav>

      {/* Контакты (Десктоп) */}
      <div class="hidden md:flex items-center gap-4 shrink-0">
        <a href={phoneLink} class="flex items-center gap-2 text-primary font-medium hover:text-accent transition-colors">
          <Phone className="w-5 h-5" />
          <span>{phoneDisplay}</span>
        </a>
      </div>

      {/* КНОПКА МОБИЛЬНОГО МЕНЮ */}
      <button 
        id="mobile-menu-toggle" 
        onclick="toggleMobileMenu(event)"
        class="md:hidden text-primary p-2 -mr-2 cursor-pointer z-[102] relative active:scale-95 transition-transform rounded-full" 
        aria-label="Меню"
      >
        <div id="icon-menu" class="pointer-events-none">
            <Menu className="w-8 h-8" />
        </div>
        <div id="icon-close" class="hidden pointer-events-none">
            <X className="w-8 h-8" />
        </div>
      </button>

    </div>

    {/* ВЫПАДАЮЩЕЕ МЕНЮ */}
    <div id="mobile-menu" class="absolute top-full left-0 right-0 mt-2 hidden md:hidden origin-top transition-all duration-500 z-[100]">
       <div class="rounded-3xl p-6 flex flex-col gap-6 bg-gradient-to-b from-white/70 to-white/40 backdrop-blur-2xl backdrop-saturate-150 border border-white/40 shadow-2xl">
         
         <nav class="flex flex-col gap-2 text-center">
          {navLinks.map(link => (
            <a href={link.href} class="text-primary text-xl font-medium py-3 border-b border-primary/10 last:border-0 hover:bg-white/40 rounded-xl transition-colors mobile-link">
              {link.label}
            </a>
          ))}
         </nav>
         
         <div class="flex flex-col items-center gap-4 pt-4 border-t border-primary/10">
            <a href={phoneLink} class="flex items-center gap-2 text-primary font-bold text-lg">
              <Phone className="w-6 h-6" />
              <span>{phoneDisplay}</span>
            </a>
            
            <a href={telegramLink} class="bg-[#1a4031]/90 backdrop-blur-md text-white px-6 py-4 rounded-full hover:bg-[#1a4031] transition-all flex items-center justify-center gap-2 w-full max-w-xs font-medium text-lg shadow-lg border border-white/10">
               <Send className="w-6 h-6" />
               <span>Написать в Telegram</span>
            </a>
         </div>
       </div>
    </div>

  </div>
</header>

<script is:inline>
  // Глобальная функция управления меню
  window.toggleMobileMenu = function(e) {
    if (e) e.stopPropagation();

    const menu = document.getElementById('mobile-menu');
    const iconMenu = document.getElementById('icon-menu');
    const iconClose = document.getElementById('icon-close');
    const headerPanel = document.getElementById('header-panel');


    const isHidden = menu.classList.contains('hidden');

    if (isHidden) {
        // Открыть
        menu.classList.remove('hidden');
        menu.classList.add('animate-in', 'fade-in', 'slide-in-from-top-4');
        if (iconMenu) iconMenu.classList.add('hidden');
        if (iconClose) iconClose.classList.remove('hidden');
        
        if (headerPanel) {
            headerPanel.classList.remove('bg-white/20');
            headerPanel.classList.add('bg-white/50');
            headerPanel.classList.add('border-transparent');
            headerPanel.classList.remove('shadow-lg');
        }
    } else {
        // Закрыть
        menu.classList.add('hidden');
        menu.classList.remove('animate-in', 'fade-in', 'slide-in-from-top-4');
        if (iconMenu) iconMenu.classList.remove('hidden');
        if (iconClose) iconClose.classList.add('hidden');
        
        if (headerPanel) {
            headerPanel.classList.add('bg-white/20');
            headerPanel.classList.remove('bg-white/50');
            headerPanel.classList.remove('border-transparent');
            headerPanel.classList.add('shadow-lg');
        }
    }
  }

  // Закрытие при клике вне меню
      window.menuListenersAdded = true;
      document.addEventListener('click', function(e) {
        const menu = document.getElementById('mobile-menu');
        const btn = document.getElementById('mobile-menu-toggle');
        
                // Закрываем вручную
                menu.classList.add('hidden');
                
                const iconMenu = document.getElementById('icon-menu');
                const iconClose = document.getElementById('icon-close');
                const headerPanel = document.getElementById('header-panel');
                
                if (iconMenu) iconMenu.classList.remove('hidden');
                if (iconClose) iconClose.classList.add('hidden');
                if (headerPanel) {
                    headerPanel.classList.add('bg-white/20');
                    headerPanel.classList.remove('bg-white/50');
                    headerPanel.classList.remove('border-transparent');
                    headerPanel.classList.add('shadow-lg');
                }
            }
        }
      });
  }
</script>
